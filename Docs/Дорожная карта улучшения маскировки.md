# –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ —É–ª—É—á—à–µ–Ω–∏—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ NovaVPN

> –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 14.02.2026
> –°—Ç–∞—Ç—É—Å: –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
> –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ü•á –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π (–º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Ññ1 –ø—Ä–æ–µ–∫—Ç–∞)

---

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏

### –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úÖ

| –ú–µ—Ä–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| TLS 1.2 Application Data –æ–±—ë—Ä—Ç–∫–∞ | –ö–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç –æ–±—ë—Ä–Ω—É—Ç –≤ `0x17 0x03 0x03 + len` |
| –ü–æ—Ä—Ç 443/UDP | –ò–º–∏—Ç–∞—Ü–∏—è HTTPS/QUIC-—Ç—Ä–∞—Ñ–∏–∫–∞ |
| –†–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è keepalive (–∫–ª–∏–µ–Ω—Ç) | 10‚Äì20 —Å–µ–∫—É–Ω–¥, `crypto/rand` |
| –†–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è keepalive (—Å–µ—Ä–≤–µ—Ä) | 18‚Äì32 —Å–µ–∫—É–Ω–¥, `crypto/rand` |
| –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ payload –¥–∞–Ω–Ω—ã—Ö | ChaCha20 XOR ‚Äî high-entropy |
| AEAD –¥–ª—è handshake | ChaCha20-Poly1305 ‚Äî high-entropy |

### –ß—Ç–æ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è DPI ‚ùå

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|----------|-------------|----------|
| 1 | **TLS Record –ø–æ–≤–µ—Ä—Ö UDP** | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è | TLS Record Header ‚Äî —Ñ–æ—Ä–º–∞—Ç TCP. –ü–æ UDP –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è DTLS (–¥—Ä—É–≥–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫) –∏–ª–∏ QUIC. DPI –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –∞–Ω–æ–º–∞–ª–∏—é. |
| 2 | **–ù–µ—Ç TLS Handshake** | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è | –ù–∞—Å—Ç–æ—è—â–∏–π TLS –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å Client Hello ‚Üí Server Hello. NovaVPN —Å—Ä–∞–∑—É —à–ª—ë—Ç Application Data. Stateful DPI –æ–±–Ω–∞—Ä—É–∂–∏—Ç. |
| 1 | **–û—Ç–∫—Ä—ã—Ç—ã–π PacketType** | ‚úÖ –†–µ—à–µ–Ω–æ | –ë–∞–π—Ç Type –æ–±—Ñ—É—Å—Ü–∏—Ä–æ–≤–∞–Ω XOR-–º–∞—Å–∫–æ–π –∏–∑ PSK |
| 2 | **–û—Ç–∫—Ä—ã—Ç—ã–π SessionID** | ‚úÖ –†–µ—à–µ–Ω–æ | SessionID –æ–±—Ñ—É—Å—Ü–∏—Ä–æ–≤–∞–Ω XOR-–º–∞—Å–∫–æ–π + –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `crypto/rand` |
| 3 | **–û—Ç–∫—Ä—ã—Ç—ã–π Counter** | ‚úÖ –†–µ—à–µ–Ω–æ | Counter –æ–±—Ñ—É—Å—Ü–∏—Ä–æ–≤–∞–Ω XOR-–º–∞—Å–∫–æ–π –∏–∑ PSK |
| 4 | **Error –ø–∞–∫–µ—Ç—ã ‚Äî –æ—Ç–∫—Ä—ã—Ç—ã–π —Ç–µ–∫—Å—Ç** | ‚úÖ –†–µ—à–µ–Ω–æ | Error-–ø–∞–∫–µ—Ç—ã —É–¥–∞–ª–µ–Ω—ã, –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –º–æ–ª—á–∞–ª–∏–≤—ã–π drop |
| 7 | **Keepalive = 10 –±–∞–π—Ç** | üü† –í—ã—Å–æ–∫–∞—è | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä 10 –±–∞–π—Ç. –í —Ä–µ–∞–ª—å–Ω–æ–º TLS payload 5 –±–∞–π—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω. |
| 8 | **HandshakeInit: SessionID=0, Nonce=0** | üü° –°—Ä–µ–¥–Ω—è—è | 12 –Ω—É–ª–µ–≤—ã—Ö –±–∞–π—Ç –Ωonce + `0x00000000` SessionID ‚Äî —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –ø–µ—Ä–≤–æ–≥–æ –ø–∞–∫–µ—Ç–∞. |
| 9 | **–ù–µ—Ç padding –¥–ª—è data** | üü° –°—Ä–µ–¥–Ω—è—è | –†–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞ = —Ç–æ—á–Ω–∞—è –¥–ª–∏–Ω–∞ IP-–ø–∞–∫–µ—Ç–∞ + 14. Traffic Analysis –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º. |
| 10 | **ServerPubKey –æ—Ç–∫—Ä—ã—Ç–æ** | üü° –°—Ä–µ–¥–Ω—è—è | –í HandshakeResp –ø–µ—Ä–≤—ã–µ 32 –±–∞–π—Ç–∞ payload ‚Äî raw Curve25519 public key –≤—Å–µ–≥–¥–∞ high-entropy, –Ω–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä. |
| 11 | **–†–∞–∑–º–µ—Ä–Ω—ã–π fingerprint handshake** | üü° –°—Ä–µ–¥–Ω—è—è | HandshakeInit ~170‚Äì200 –±–∞–π—Ç, HandshakeResp ~190‚Äì220 –±–∞–π—Ç. –ü–∞—Ç—Ç–µ—Ä–Ω –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª. |

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–ª—É—á—à–µ–Ω–∏–π

–í—Å–µ —É–ª—É—á—à–µ–Ω–∏—è —Ä–∞–∑–±–∏—Ç—ã –Ω–∞ 4 —ç—Ç–∞–ø–∞. –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ. –≠—Ç–∞–ø—ã —É–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã –ø–æ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—é ¬´—ç—Ñ—Ñ–µ–∫—Ç –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ / —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏¬ª.

---

## –≠—Ç–∞–ø 1: –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ (—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–ª–µ–π) ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù

> –°–ª–æ–∂–Ω–æ—Å—Ç—å: —Å—Ä–µ–¥–Ω—è—è | –≠—Ñ—Ñ–µ–∫—Ç: üî¥üî¥üî¥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π | –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ
> **–°—Ç–∞—Ç—É—Å: —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ** (—Å–µ—Ä–≤–µ—Ä, –∫–ª–∏–µ–Ω—Ç, –±–µ–Ω—á–º–∞—Ä–∫)

### 1.1. –û–±—Ñ—É—Å–∫–∞—Ü–∏—è SessionID + PacketType + Counter

**–ü—Ä–æ–±–ª–µ–º–∞:** SessionID (4B), PacketType (1B) –∏ Counter (4B) –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–æ. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç DPI –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç—ã, –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö.

**–†–µ—à–µ–Ω–∏–µ:** XOR-–æ–±—Ñ—É—Å–∫–∞—Ü–∏—è header-–±–ª–æ–∫–∞ –∫–ª—é—á–æ–º, –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–º –æ—Ç PSK.

```
header_mask = HMAC-SHA256(PSK, "nova-header-mask")[:9]   // 9 –±–∞–π—Ç –º–∞—Å–∫–∞

// –û—Ç–ø—Ä–∞–≤–∫–∞ (–ø–æ—Å–ª–µ TLS header):
raw[0:4] = SessionID XOR header_mask[0:4]
raw[4]   = PacketType XOR header_mask[4]
raw[5:9] = Counter XOR header_mask[5:9]    // —Ç–æ–ª—å–∫–æ –¥–ª—è data-–ø–∞–∫–µ—Ç–æ–≤

// –ü—Ä–∏—ë–º ‚Äî —Ç–∞ –∂–µ –æ–ø–µ—Ä–∞—Ü–∏—è (XOR –æ–±—Ä–∞—Ç–∏–º):
SessionID = raw[0:4] XOR header_mask[0:4]
PacketType = raw[4] XOR header_mask[4]
```

**–ù—é–∞–Ω—Å:** –°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–±–æ–≤–∞—Ç—å –¥–µ–æ–±—Ñ—É—Å–∫–∞—Ü–∏—é —Å PSK. –î–ª—è HandshakeInit (SessionID=0, zero PSK –ø—Ä–∏ bootstrap) ‚Äî –º–∞—Å–∫–∞ –∏–∑ –Ω—É–ª–µ–≤–æ–≥–æ –∫–ª—é—á–∞.

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `vpn-server/internal/protocol/packet.go` ‚Äî `AddTLSHeader`, `Marshal`, `Unmarshal`
- `vpn-server/internal/server/server.go` ‚Äî `processUDPPacket` (—Å–Ω–∞—á–∞–ª–∞ –¥–µ–æ–±—Ñ—É—Å–∫–∞—Ü–∏—è)
- `vpn-client-windows/internal/protocol/protocol.go` ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- `vpn-client-windows/internal/infrastructure/vpn/client.go` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ data/keepalive
- `vpn-server/cmd/vpnbench/` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç –±–µ–Ω—á–º–∞—Ä–∫–∞

**–ú–µ—Ç—Ä–∏–∫–∞:** 1 HMAC-SHA256 –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Å—Å–∏–∏ (–Ω–µ –Ω–∞ –∫–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç) + XOR 9 –±–∞–π—Ç –Ω–∞ –∫–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç ‚âà +5 –Ω—Å/–ø–∞–∫–µ—Ç.

### 1.2. –†–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è SessionID

**–ü—Ä–æ–±–ª–µ–º–∞:** `nextSessionID.Add(1)` ‚Äî –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π. DPI –≤–∏–¥–∏—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ ID –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:** `crypto/rand` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ 4-–±–∞–π—Ç–Ω–æ–≥–æ SessionID —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ `SessionManager`.

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `vpn-server/internal/server/session.go` ‚Äî `CreateSession`

### 1.3. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ Error-–ø–∞–∫–µ—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** Error-–ø–∞–∫–µ—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –æ—Ç–∫—Ä—ã—Ç—ã–π ASCII —Ç–µ–∫—Å—Ç (`"auth_failed"`).

**–†–µ—à–µ–Ω–∏–µ:** –î–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ (–æ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –∫ –ª—É—á—à–µ–º—É):
- **–í–∞—Ä–∏–∞–Ω—Ç A:** –£–±—Ä–∞—Ç—å Error-–ø–∞–∫–µ—Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é ‚Äî –º–æ–ª—á–∞–ª–∏–≤—ã–π drop (–∫–∞–∫ –ø—Ä–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–º HMAC)
- **–í–∞—Ä–∏–∞–Ω—Ç B:** –®–∏—Ñ—Ä–æ–≤–∞—Ç—å Error payload —á–µ—Ä–µ–∑ ChaCha20-Poly1305 —Å PSK

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: **–í–∞—Ä–∏–∞–Ω—Ç A** ‚Äî –ø—Ä–æ—â–µ, –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ, –ª—É—á—à–µ –¥–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ (–º–µ–Ω—å—à–µ —Ç—Ä–∞—Ñ–∏–∫–∞ = –º–µ–Ω—å—à–µ fingerprint). –ö–ª–∏–µ–Ω—Ç —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç—ã.

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `vpn-server/internal/server/handler.go` ‚Äî `sendErrorPacket` ‚Üí —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ —à–∏—Ñ—Ä–æ–≤–∞—Ç—å
- `vpn-client-windows/internal/infrastructure/vpn/handshake/performer.go` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

## –≠—Ç–∞–ø 2: Padding (—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–Ω—ã—Ö —Å–∏–≥–Ω–∞—Ç—É—Ä)

> –°–ª–æ–∂–Ω–æ—Å—Ç—å: —Å—Ä–µ–¥–Ω—è—è | –≠—Ñ—Ñ–µ–∫—Ç: üü†üü† –≤—ã—Å–æ–∫–∏–π | –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: +2‚Äì5% overhead —Ç—Ä–∞—Ñ–∏–∫–∞

### 2.1. Padding Keepalive/Disconnect

**–ü—Ä–æ–±–ª–µ–º–∞:** –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä 10 –±–∞–π—Ç ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞. –í TLS —Ç–∞–∫–æ–π –º–∞–ª–µ–Ω—å–∫–∏–π record –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π padding 40‚Äì150 –±–∞–π—Ç (–∏—Ç–æ–≥–æ 50‚Äì160 –±–∞–π—Ç ‚Äî —Ç–∏–ø–∏—á–Ω—ã–π —Ä–∞–∑–º–µ—Ä TLS Application Data record –¥–ª—è keepalive).

```
// –í–º–µ—Å—Ç–æ: TLS(5) + SID(4) + Type(1) = 10
// –î–µ–ª–∞–µ–º: TLS(5) + SID(4) + Type(1) + PadLen(1) + RandomPad(40-150) = 51-161
```

`PadLen` (1 –±–∞–π—Ç) ‚Äî –¥–ª–∏–Ω–∞ padding, –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–µ—Ä–≤–µ—Ä—É/–∫–ª–∏–µ–Ω—Ç—É –æ—Ç—Å–µ—á—å –º—É—Å–æ—Ä.

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `vpn-server/internal/protocol/packet.go` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å padding –∫ keepalive/disconnect
- `vpn-server/internal/server/server.go` ‚Äî `sendKeepalive`, keepalive loop
- `vpn-client-windows/internal/infrastructure/vpn/client.go` ‚Äî `sendKeepalive`, `sendDisconnect`

**–ú–µ—Ç—Ä–∏–∫–∞:** +40‚Äì150 –±–∞–π—Ç –Ω–∞ keepalive. –ü—Ä–∏ keepalive –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫ = +3‚Äì10 –±–∞–π—Ç/—Å–µ–∫. –ù–µ–∑–∞–º–µ—Ç–Ω–æ.

### 2.2. Padding Data-–ø–∞–∫–µ—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –†–∞–∑–º–µ—Ä data-–ø–∞–∫–µ—Ç–∞ = —Ç–æ—á–Ω–∞—è –¥–ª–∏–Ω–∞ IP-–ø–∞–∫–µ—Ç–∞ + 14 –±–∞–π—Ç. –ü–æ–∑–≤–æ–ª—è–µ—Ç traffic analysis.

**–†–µ—à–µ–Ω–∏–µ:** –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ –∫—Ä–∞—Ç–Ω–æ–≥–æ 64 –±–∞–π—Ç + —Å–ª—É—á–∞–π–Ω—ã–π padding 0‚Äì32 –±–∞–π—Ç–∞.

```
paddedSize = ceil(plaintext_len / 64) * 64 + random(0, 32)
pad = paddedSize - plaintext_len
packet = TLS(5) + SID(4) + Type(1) + Counter(4) + PadLen(1) + encrypt(plaintext + random_bytes(pad))
```

`PadLen` (1 –±–∞–π—Ç, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω –≤–º–µ—Å—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏) ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—é –æ—Ç–±—Ä–æ—Å–∏—Ç—å padding –ø–æ—Å–ª–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏.

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** Padding –≤–∫–ª—é—á–∞—Ç—å **–≤–Ω—É—Ç—Ä—å** —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–π –±–∞–π—Ç = –¥–ª–∏–Ω–∞ padding), —á—Ç–æ–±—ã –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å –µ—â—ë –æ–¥–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ.

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `vpn-server/internal/server/session.go` ‚Äî `EncryptAndBuildDataPacket`
- `vpn-server/internal/server/handler.go` ‚Äî `processDataPacket`
- `vpn-client-windows/internal/infrastructure/crypto/session.go` ‚Äî `Encrypt`, `Decrypt`
- `vpn-client-windows/internal/infrastructure/vpn/client.go` ‚Äî `tunReadLoop`, `handleIncomingData`

**–ö–æ–º–ø—Ä–æ–º–∏—Å—Å—ã:**
- Overhead —Ç—Ä–∞—Ñ–∏–∫–∞: ~5% (–≤ —Å—Ä–µ–¥–Ω–µ–º +32 –±–∞–π—Ç–∞ –Ω–∞ –ø–∞–∫–µ—Ç 1400 –±–∞–π—Ç)
- MTU: –Ω—É–∂–Ω–æ —É—á–µ—Å—Ç—å –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ TUN-–ø–∞–∫–µ—Ç–∞ (—É–º–µ–Ω—å—à–∏—Ç—å effective MTU)
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: `crypto/rand.Read` –¥–ª—è padding ‚Äî –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ CSPRNG –∏–∑ sendKey –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏

### 2.3. Padding HandshakeInit/Resp

**–ü—Ä–æ–±–ª–µ–º–∞:** HandshakeInit ~170‚Äì200 –±–∞–π—Ç, HandshakeResp ~190‚Äì220 –±–∞–π—Ç ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ–º—ã–µ —Ä–∞–∑–º–µ—Ä—ã.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å random padding –¥–æ 300‚Äì600 –±–∞–π—Ç (—Ç–∏–ø–∏—á–Ω—ã–π TLS record).

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `vpn-server/internal/protocol/handshake.go` ‚Äî `MarshalHandshakeInit`, `MarshalHandshakeResp`
- `vpn-server/internal/server/handler.go` ‚Äî `handleHandshakeInit`
- `vpn-client-windows/internal/infrastructure/vpn/handshake/performer.go` ‚Äî —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Init

---

## –≠—Ç–∞–ø 3: QUIC-–ø–æ–¥–æ–±–Ω–∞—è –æ–±—Ñ—É—Å–∫–∞—Ü–∏—è (—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—å–Ω–æ–π –∞–Ω–æ–º–∞–ª–∏–∏)

> –°–ª–æ–∂–Ω–æ—Å—Ç—å: –≤—ã—Å–æ–∫–∞—è | –≠—Ñ—Ñ–µ–∫—Ç: üî¥üî¥üî¥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π | –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –Ω—É–ª–µ–≤–æ–µ

### 3.1. –ü—Ä–æ–±–ª–µ–º–∞ TLS-over-UDP

–¢–µ–∫—É—â–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ `0x17 0x03 0x03` ‚Äî —Ñ–æ—Ä–º–∞—Ç TLS Record Layer, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –ø–æ TCP**. –ü–æ UDP:443 —Ö–æ–¥—è—Ç:
- **QUIC** (Chrome, Firefox) ‚Äî –∏–º–µ–µ—Ç —Å–≤–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ (QUIC Initial, QUIC Short Header)
- **DTLS** ‚Äî –∏–º–µ–µ—Ç —Å–≤–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ (ContentType + Epoch + SequenceNumber)

DPI, –≤–∏–¥—è TLS Record Layer –ø–æ UDP, –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ –Ω–µ –ª–µ–≥–∏—Ç–∏–º–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª.

### 3.2. –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥ QUIC (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

QUIC ‚Äî —Å–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –Ω–∞ UDP:443. –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥ QUIC Short Header:

```
QUIC Short Header (—Ä–µ–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 0 1  ‚îÇ Destination Conn ID ‚îÇ Encrypted Payload  ‚îÇ
‚îÇ Flags‚îÇ      0-20 –±–∞–π—Ç      ‚îÇ                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ü–µ—Ä–≤—ã–π –±–∏—Ç = 0 (Short Header), —Å–ª–µ–¥—É—é—â–∏–µ –±–∏—Ç—ã = flags.
```

–ù–∞—à –ø—Ä–æ—Ç–æ–∫–æ–ª –º–æ–∂–µ—Ç –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å QUIC Short Header:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Flags‚îÇ Connection ID (4-8B)‚îÇ Obfuscated Packet Data     ‚îÇ
‚îÇ  1B  ‚îÇ  = SessionID        ‚îÇ = Type + Counter + Payload ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

- `Flags`: —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ –≤–∞–ª–∏–¥–Ω—ã–µ QUIC flags (Header Form=0, Fixed Bit=1, ...)
- `Connection ID`: –Ω–∞—à SessionID (QUIC Connection ID = 0‚Äì20 –±–∞–π—Ç, 4 –±–∞–π—Ç–∞ ‚Äî –≤–∞–ª–∏–¥–Ω–æ)
- –û—Å—Ç–∞–ª—å–Ω–æ–µ: –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ/–æ–±—Ñ—É—Å—Ü–∏—Ä–æ–≤–∞–Ω–æ

**–ü–ª—é—Å—ã:** QUIC ‚Äî –ª–µ–≥–∏—Ç–∏–º–Ω—ã–π UDP:443 —Ç—Ä–∞—Ñ–∏–∫, DPI –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç (–∏–Ω–∞—á–µ —Å–ª–æ–º–∞–µ—Ç—Å—è YouTube, Gmail, ..)
**–ú–∏–Ω—É—Å—ã:** –ù—É–∂–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å QUIC Initial (–¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –ø–∞–∫–µ—Ç–∞), —Å–ª–æ–∂–Ω–µ–µ –ø–∞—Ä—Å–∏–Ω–≥

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥ DTLS

DTLS 1.2 Record Layer:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Content Type ‚îÇ  Version‚îÇ  Epoch  ‚îÇ Seq Num  ‚îÇ Length + Payload ‚îÇ
‚îÇ     1B       ‚îÇ   2B    ‚îÇ   2B    ‚îÇ   6B     ‚îÇ   2B + var      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü–ª—é—Å—ã:** –ü—Ä–æ—â–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å (–∑–∞–º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫), –ª–µ–≥–∏—Ç–∏–º–Ω—ã–π UDP+TLS –ø—Ä–æ—Ç–æ–∫–æ–ª (WebRTC, VoIP)
**–ú–∏–Ω—É—Å—ã:** DTLS –º–µ–Ω–µ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω —á–µ–º QUIC, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ DPI –º–æ–≥—É—Ç –∏–Ω—Å–ø–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω–µ–µ

#### –í–∞—Ä–∏–∞–Ω—Ç C: –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ (random bytes)

–í–º–µ—Å—Ç–æ –ª—é–±–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–µ–º–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–ª—É—á–∞–π–Ω—ã–µ –±–∞–π—Ç—ã:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Fully encrypted/random looking data      ‚îÇ
‚îÇ  (no recognizable header at all)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

–°–µ—Ä–≤–µ—Ä –≤—ã—á–∏—Å–ª—è–µ—Ç `header_key = HKDF(PSK, "nova-header")` –∏ –ø—Ä–æ–±—É–µ—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–≤—ã–µ N –±–∞–π—Ç –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞.

**–ü–ª—é—Å—ã:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ DPI ‚Äî –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª
**–ú–∏–Ω—É—Å—ã:** –°–µ—Ä–≤–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–æ –æ—Ç—Å–µ—è—Ç—å –º—É—Å–æ—Ä–Ω—ã–µ –ø–∞–∫–µ—Ç—ã, –º–æ–∂–µ—Ç –±—ã—Ç—å –∞—Ç–∞–∫–æ–≤–∞–Ω UDP-—Ñ–ª—É–¥–æ–º

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç A (QUIC) –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Ä–∏—Å–∫–æ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏. –í–∞—Ä–∏–∞–Ω—Ç C –∫–∞–∫ fallback –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ DPI.

### 3.3. –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

- `vpn-server/internal/protocol/packet.go` ‚Äî –ø–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ `AddTLSHeader`/`ParseTLSHeader` –Ω–∞ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç
- `vpn-client-windows/internal/protocol/protocol.go` ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ
- –í—Å–µ —Ñ–∞–π–ª—ã, —Ñ–æ—Ä–º–∏—Ä—É—é—â–∏–µ/–ø–∞—Ä—Å—è—â–∏–µ –ø–∞–∫–µ—Ç—ã

---

## –≠—Ç–∞–ø 4: –ò–º–∏—Ç–∞—Ü–∏—è TLS Handshake (–¥–ª—è TCP-fallback)

> –°–ª–æ–∂–Ω–æ—Å—Ç—å: –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | –≠—Ñ—Ñ–µ–∫—Ç: üü° —Å—Ä–µ–¥–Ω–∏–π (–∞–∫—Ç—É–∞–ª—å–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ TCP) | –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π

### 4.1. –û–ø–∏—Å–∞–Ω–∏–µ

–ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –±—É–¥–µ—Ç TCP-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –Ω—É–∂–Ω–∞ –∏–º–∏—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ TLS 1.3 handshake:
- Client Hello —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ TLS extensions (SNI, ALPN, ...)
- Server Hello —Å Certificate (–ø–æ–¥–¥–µ–ª—å–Ω—ã–º –∏–ª–∏ Let's Encrypt)
- –î–∞–ª—å–Ω–µ–π—à–∏–π —Ç—Ä–∞—Ñ–∏–∫ ‚Äî –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∏–π TLS Application Data

–≠—Ç–æ –∞–Ω–∞–ª–æ–≥ —Ç–æ–≥–æ, —á—Ç–æ –¥–µ–ª–∞—é—Ç **V2Ray/VMess**, **Trojan-GFW**, **Shadowsocks-AEAD —Å –ø–ª–∞–≥–∏–Ω–∞–º–∏**.

### 4.2. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- –î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è –¥–ª—è SNI (–º–æ–∂–Ω–æ –∑–∞—Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–π CDN –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å domain fronting)
- TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt –∏–ª–∏ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π)
- –ü–æ–ª–Ω—ã–π TLS state machine –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û—Ç–ª–æ–∂–∏—Ç—å –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–π –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ (TCP-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç). –î–ª—è UDP —Ç–µ–∫—É—â–∏–π –≠—Ç–∞–ø 3 (QUIC-–æ–±—Ñ—É—Å–∫–∞—Ü–∏—è) –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω.

---

## –°–≤–æ–¥–∫–∞ —ç—Ç–∞–ø–æ–≤

| –≠—Ç–∞–ø | –ù–∞–∑–≤–∞–Ω–∏–µ | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –≠—Ñ—Ñ–µ–∫—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|-----------|--------|----------|
| **1** | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ | –°—Ä–µ–¥–Ω—è—è | üî¥üî¥üî¥ | ‚úÖ XOR-–æ–±—Ñ—É—Å–∫–∞—Ü–∏—è SID+Type+Counter, —Ä–∞–Ω–¥–æ–º SID, —É–±—Ä–∞–Ω—ã Error-–ø–∞–∫–µ—Ç—ã |
| **2** | Padding | –°—Ä–µ–¥–Ω—è—è | üü†üü† | Padding keepalive (40-150B), data (–¥–æ –∫—Ä–∞—Ç–Ω—ã—Ö 64), handshake (–¥–æ 300-600B) |
| **3** | QUIC-–æ–±—Ñ—É—Å–∫–∞—Ü–∏—è | –í—ã—Å–æ–∫–∞—è | üî¥üî¥üî¥ | –ó–∞–º–µ–Ω–∞ TLS Record Header –Ω–∞ QUIC Short Header –∏–ª–∏ –ø–æ–ª–Ω—É—é –æ–±—Ñ—É—Å–∫–∞—Ü–∏—é |
| **4** | TLS Handshake | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | üü° | –ò–º–∏—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ TLS 1.3 –¥–ª—è TCP-fallback (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) |

---

## –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```
–≠—Ç–∞–ø 1 (–∑–∞–≥–æ–ª–æ–≤–æ–∫)  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫  –≠—Ç–∞–ø 2 (padding)  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫  –≠—Ç–∞–ø 3 (QUIC)
     ~2-3 –¥–Ω—è                   ~2-3 –¥–Ω—è                 ~5-7 –¥–Ω–µ–π
```

–≠—Ç–∞–ø—ã 1 –∏ 2 –º–æ–≥—É—Ç –∏–¥—Ç–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ. –≠—Ç–∞–ø 3 —Ç—Ä–µ–±—É–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≠—Ç–∞–ø–∞ 1 (—Ç.–∫. –º–µ–Ω—è–µ—Ç—Å—è –≤–µ—Å—å —Ñ–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞). –≠—Ç–∞–ø 4 ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç.

---

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ò–∑–º–µ–Ω–µ–Ω–∏–µ | Overhead CPU | Overhead —Ç—Ä–∞—Ñ–∏–∫–∞ | –í–ª–∏—è–Ω–∏–µ –Ω–∞ RTT |
|-----------|-------------|-----------------|----------------|
| XOR header (9B) | +5 –Ω—Å/–ø–∞–∫–µ—Ç | 0% | 0 |
| Random SessionID | ‚âà0 (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏) | 0% | 0 |
| Padding keepalive | ‚âà0 | +40-150 –±–∞–π—Ç/15 —Å–µ–∫ | 0 |
| Padding data | +50 –Ω—Å (random gen) | +2-5% | 0 |
| QUIC header | ‚âà0 (–∑–∞–º–µ–Ω–∞ 5B ‚Üí 1+4B) | 0% | 0 |

**–ò—Ç–æ–≥–æ:** —Å—É–º–º–∞—Ä–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å **–ø—Ä–µ–Ω–µ–±—Ä–µ–∂–∏–º–æ –º–∞–ª–æ**.

---

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

‚ö†Ô∏è **–ö–∞–∂–¥—ã–π —ç—Ç–∞–ø ‚Äî breaking change.** –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã (Windows, Android TV, –±–µ–Ω—á–º–∞—Ä–∫) –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (–ø–æ–ª–µ Version –≤ wire format)
2. –ü–µ—Ä–∏–æ–¥ dual-stack: —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏ —Å—Ç–∞—Ä—ã–π, –∏ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–Ω—á–º–∞—Ä–∫–∞ (`vpn-server/cmd/vpnbench/`) –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏

---

## –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏

### –û—Ü–µ–Ω–∫–∞ –ø–æ —à–∫–∞–ª–µ –∑—Ä–µ–ª–æ—Å—Ç–∏ DPI-–æ–±—Ö–æ–¥–∞

| –£—Ä–æ–≤–µ–Ω—å | –û–ø–∏—Å–∞–Ω–∏–µ | NovaVPN |
|---------|----------|---------|
| 0 | –ù–∏–∫–∞–∫–æ–π –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ (WireGuard, OpenVPN) | |
| 1 | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ payload (–Ω–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö fingerprints –≤ data) | ‚úÖ –°–µ–π—á–∞—Å |
| 2 | –û–±—Ñ—É—Å–∫–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (–Ω–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö) | ‚Üê –≠—Ç–∞–ø 1+2 |
| 3 | –ò–º–∏—Ç–∞—Ü–∏—è –ª–µ–≥–∏—Ç–∏–º–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (QUIC/DTLS/TLS) | ‚Üê –≠—Ç–∞–ø 3 |
| 4 | –ü–æ–ª–Ω–∞—è –∏–º–∏—Ç–∞—Ü–∏—è —Å handshake (Trojan-—É—Ä–æ–≤–µ–Ω—å) | ‚Üê –≠—Ç–∞–ø 4 |

### –ö—Ç–æ —á—Ç–æ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç

| DPI | –û–±–Ω–∞—Ä—É–∂–∏—Ç —Ç–µ–∫—É—â–∏–π NovaVPN? | –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1+2 | –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 3 |
|-----|---------------------------|-----------------|---------------|
| –ü—Ä–æ—Å—Ç–æ–π firewall (–ø–æ—Ä—Ç+–ø—Ä–æ—Ç–æ–∫–æ–ª) | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç |
| Passive DPI (header inspection) | ‚úÖ –î–∞ (TLS-over-UDP) | ‚ö†Ô∏è –°–ª–æ–∂–Ω–æ | ‚ùå –ù–µ—Ç |
| Stateful DPI (–ø—Ä–æ—Ç–æ–∫–æ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑) | ‚úÖ –î–∞ (–Ω–µ—Ç TLS Hello) | ‚úÖ –î–∞ | ‚ö†Ô∏è –°–ª–æ–∂–Ω–æ |
| ML/Statistical DPI (pattern analysis) | ‚úÖ –î–∞ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã) | ‚ö†Ô∏è –°–ª–æ–∂–Ω–æ | ‚ùå –ù–µ—Ç |
| GFW —É—Ä–æ–≤–Ω—è –ö–∏—Ç–∞—è | ‚úÖ –î–∞ | ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ | ‚ö†Ô∏è –°–ª–æ–∂–Ω–æ |

---

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏

| –ü—Ä–æ—Ç–æ–∫–æ–ª | –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ | –£—Ä–æ–≤–µ–Ω—å | –ú–µ—Ç–æ–¥ |
|----------|-----------|---------|-------|
| WireGuard | ‚ùå –ù–µ—Ç | 0 | –û—Ç–∫—Ä—ã—Ç—ã–π —Ñ–æ—Ä–º–∞—Ç, –ª–µ–≥–∫–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è |
| OpenVPN | ‚ùå –ù–µ—Ç | 0 | –•–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–π opcode, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ structure |
| **NovaVPN (—Å–µ–π—á–∞—Å)** | ‚ö†Ô∏è –ë–∞–∑–æ–≤–∞—è | 1 | TLS Record Header –æ–±—ë—Ä—Ç–∫–∞ (–∞–Ω–æ–º–∞–ª—å–Ω–∞—è –ø–æ UDP) |
| Shadowsocks-AEAD | ‚úÖ –•–æ—Ä–æ—à–∞—è | 2 | –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π stream, random-looking |
| V2Ray/VMess | ‚úÖ –•–æ—Ä–æ—à–∞—è | 2-3 | –û–±—Ñ—É—Å–∫–∞—Ü–∏—è + –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è TLS/QUIC –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ |
| Trojan-GFW | ‚úÖ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è | 4 | –ü–æ–ª–Ω–∞—è –∏–º–∏—Ç–∞—Ü–∏—è HTTPS —Å —Ä–µ–∞–ª—å–Ω—ã–º TLS + —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º |
| **NovaVPN (–ø–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 3)** | ‚úÖ –•–æ—Ä–æ—à–∞—è | 3 | QUIC-–ø–æ–¥–æ–±–Ω–∞—è –æ–±—Ñ—É—Å–∫–∞—Ü–∏—è |
