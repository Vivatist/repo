# –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ NovaVPN

> –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 14.02.2026
> –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 14.02.2026
> –°—Ç–∞—Ç—É—Å: —ç—Ç–∞–ø—ã 0‚Äì4.5, 6‚Äì10 –∑–∞–≤–µ—Ä—à–µ–Ω—ã, –±–µ–Ω—á–º–∞—Ä–∫-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω (—Ä–µ–∂–∏–º rtt + throughput)
> –ü–æ—Å–ª–µ–¥–Ω–∏–π –±–µ–Ω—á–º–∞—Ä–∫: 14.02.2026 ‚Äî –æ—Ü–µ–Ω–∫–∞ –•–û–†–û–®–û (524 –ú–±–∏—Ç/—Å, RTT p50 102 –º–∫—Å, handshake avg 1.9 –º—Å –ø—Ä–∏ 50 –∫–ª–∏–µ–Ω—Ç–∞—Ö)

---

## –ü—Ä–∏–Ω—Ü–∏–ø—ã

–í—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–¥—á–∏–Ω—è—é—Ç—Å—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º –ø—Ä–æ–µ–∫—Ç–∞:
1. **–ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞** ‚Äî –Ω–∏ –æ–¥–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ —É—Ö—É–¥—à–∞—Ç—å stealth
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî —Ü–µ–ª—å —ç—Ç–æ–π –¥–æ—Ä–æ–∂–Ω–æ–π –∫–∞—Ä—Ç—ã
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–Ω–æ (–æ–Ω–æ –∂–µ —á–∞—Å—Ç—å –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏)

**–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–ª—å–∑—è —É–±—Ä–∞—Ç—å/–æ—Å–ª–∞–±–∏—Ç—å** ‚Äî ChaCha20 —Å–æ–∑–¥–∞—ë—Ç high-entropy –¥–∞–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ TLS record, —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏. –ë–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è DPI –æ–±–Ω–∞—Ä—É–∂–∏—Ç structured IPv4 headers –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É —ç–Ω—Ç—Ä–æ–ø–∏–∏.

---

## –ü—Ä–æ—Ñ–∏–ª—å –Ω–∞–≥—Ä—É–∑–∫–∏ (–Ω–∞ 1 –ø–∞–∫–µ—Ç, 1400 –±–∞–π—Ç)

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è | –î–æ–ª—è CPU |
|----------|-------|----------|
| ChaCha20 init + XOR | ~400 –Ω—Å | 4% |
| UDP syscall (read/write) | ~2000 –Ω—Å | 40% |
| TUN syscall (read/write) | ~2000 –Ω—Å | 40% |
| Session lookup (RLock) | ~100 –Ω—Å | 1% |
| –ü—Ä–æ—á–µ–µ | ~1500 –Ω—Å | 15% |

**–í—ã–≤–æ–¥:** 80% –≤—Ä–µ–º–µ–Ω–∏ ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã (syscalls). –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–¥–æ I/O.

---

## –£–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—Ñ–∞–∑–∞ 0)

- [x] `ExtractDstIPKey` ‚Äî zero-alloc –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ dst IP –∫–∞–∫ `[4]byte`
- [x] `GetSessionByIPKey` ‚Äî zero-alloc lookup —Å–µ—Å—Å–∏–∏ –ø–æ IP-–∫–ª—é—á—É
- [x] `tunReadLoop` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è zero-alloc lookup
- [x] `randomKeepaliveInterval` ‚Äî —É–±—Ä–∞–Ω—ã allocations `big.Int`
- [x] `randomCheckInterval` (–∫–ª–∏–µ–Ω—Ç) ‚Äî —É–±—Ä–∞–Ω—ã `big.Int`
- [x] `keepaliveLoop` (–∫–ª–∏–µ–Ω—Ç) ‚Äî `time.After` ‚Üí `time.Timer` (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞)
- [x] `monitorLoop` (–∫–ª–∏–µ–Ω—Ç) ‚Äî `time.After` ‚Üí `time.Timer`

---

## –≠—Ç–∞–ø 1: Batch UDP –æ—Ç–ø—Ä–∞–≤–∫–∞ ‚Äî sendmmsg (—Å–µ—Ä–≤–µ—Ä) ‚úÖ

**–§–∞–π–ª—ã:** `vpn-server/internal/server/server.go`, `vpn-server/internal/server/batch_linux.go`

**–ü—Ä–æ–±–ª–µ–º–∞:** `tunReadLoop` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞–∫–µ—Ç—ã –ø–æ –æ–¥–Ω–æ–º—É —á–µ—Ä–µ–∑ `WriteToUDP` ‚Äî 1 syscall / –ø–∞–∫–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:** –ö–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä `batchSender` + `sendmmsg` ‚Äî –¥–æ 64 –ø–∞–∫–µ—Ç–æ–≤ –∑–∞ 1 syscall.

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- `batchSender` ‚Äî ring buffer —Å –ø—Ä–µ-–∞–ª–ª–æ—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –±—É—Ñ–µ—Ä–∞–º–∏ (64 —Å–ª–æ—Ç–∞)
- Flush goroutine —Å —Ç–∞–π–º–µ—Ä–æ–º 100 –º–∫—Å + –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π flush –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏
- `sendToClientBatch` ‚Äî —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä—è–º–æ –≤ batch-–±—É—Ñ–µ—Ä (zero-copy)
- Fallback –Ω–∞ `WriteToUDP` –µ—Å–ª–∏ `getUDPSocketFd` –Ω–µ —É–¥–∞–ª—Å—è

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫—É:** –Ω—É–ª–µ–≤–æ–µ (wire format –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è).

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –∑–∞–≤–µ—Ä—à—ë–Ω

---

## –≠—Ç–∞–ø 2: Batch UDP –ø—Ä–∏—ë–º ‚Äî recvmmsg (—Å–µ—Ä–≤–µ—Ä) ‚úÖ

**–§–∞–π–ª—ã:** `vpn-server/internal/server/server.go`, `vpn-server/internal/server/batch_linux.go`

**–ü—Ä–æ–±–ª–µ–º–∞:** `udpReadLoop` —á–∏—Ç–∞–µ—Ç –ø–æ 1 –ø–∞–∫–µ—Ç—É —á–µ—Ä–µ–∑ `ReadFromUDP` ‚Äî 1 syscall / –ø–∞–∫–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:** `recvmmsg` + `batchReceiver` —á–∏—Ç–∞–µ—Ç –¥–æ 64 –ø–∞–∫–µ—Ç–æ–≤ –∑–∞ 1 syscall.

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- `batchReceiver` ‚Äî –ø—Ä–µ-–∞–ª–ª–æ—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±—É—Ñ–µ—Ä—ã, iovec, sockaddr –¥–ª—è 64 –ø–∞–∫–µ—Ç–æ–≤
- `recvmmsg` syscall —Å `MSG_WAITFORONE` (–≤–æ–∑–≤—Ä–∞—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –ø–∞–∫–µ—Ç–∞)
- `processUDPPacket` ‚Äî –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞ (batch + fallback)
- Fallback –Ω–∞ `ReadFromUDP` –µ—Å–ª–∏ batch receiver –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫—É:** –Ω—É–ª–µ–≤–æ–µ.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –∑–∞–≤–µ—Ä—à—ë–Ω

---

## –≠—Ç–∞–ø 3: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ UDP –±—É—Ñ–µ—Ä–æ–≤ (—Å–µ—Ä–≤–µ—Ä) ‚úÖ

**–§–∞–π–ª—ã:** `vpn-server/internal/server/server.go`

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –±—É—Ñ–µ—Ä—ã UDP-—Å–æ–∫–µ—Ç–∞ (4 –ú–ë) –ø–µ—Ä–µ–ø–æ–ª–Ω—è—é—Ç—Å—è –ø—Ä–∏ burst'–∞—Ö.

**–†–µ—à–µ–Ω–∏–µ:** Fallback-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è: 16 –ú–ë ‚Üí 8 –ú–ë ‚Üí 4 –ú–ë —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- `tuneSocketBuffers()` ‚Äî –º–µ—Ç–æ–¥ —Å fallback —á–µ—Ä–µ–∑ 3 —É—Ä–æ–≤–Ω—è (16/8/4 –ú–ë)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –±—É—Ñ–µ—Ä–∞

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫—É:** –Ω—É–ª–µ–≤–æ–µ.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –∑–∞–≤–µ—Ä—à—ë–Ω

---

## –≠—Ç–∞–ø 4: LRU-1 session cache (—Å–µ—Ä–≤–µ—Ä) ‚úÖ

**–§–∞–π–ª—ã:** `vpn-server/internal/server/session.go`, `vpn-server/internal/server/server.go`

**–ü—Ä–æ–±–ª–µ–º–∞:** `GetSessionByID` –∏ `GetSessionByIPKey` –±–µ—Ä—É—Ç `RWMutex.RLock` –Ω–∞ –∫–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:** LRU-1 –∫–µ—à –≤–º–µ—Å—Ç–æ `sync.Map` (sync.Map —Å–æ–∑–¥–∞—ë—Ç interface boxing = –∞–ª–ª–æ–∫–∞—Ü–∏—è –Ω–∞ –∫–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç).

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- `sessionCache` ‚Äî –∫–µ—à –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–µ—Å—Å–∏–∏ –ø–æ SessionID –¥–ª—è `udpReadLoop` (1 –≥–æ—Ä—É—Ç–∏–Ω–∞)
- `ipSessionCache` ‚Äî –∫–µ—à –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–µ—Å—Å–∏–∏ –ø–æ VPN IP –¥–ª—è `tunReadLoop` (1 –≥–æ—Ä—É—Ç–∏–Ω–∞)
- –ü—Ä–∏ cache hit ‚Äî –Ω—É–ª–µ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (–±–µ–∑ RLock, –±–µ–∑ map lookup)
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å: stale session –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `IsActive()` (atomic state)
- –ú–æ–Ω–æ—Ç–æ–Ω–Ω—ã–π sessionID –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ ID reuse

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ RLock –Ω–∞ hot path –¥–ª—è single-client (100% hit rate), –≤—ã—Å–æ–∫–∏–π hit rate –¥–ª—è multi-client (–ø–∞–∫–µ—Ç—ã –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω—ã –ø–æ —Å–µ—Å—Å–∏—è–º).

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫—É:** –Ω—É–ª–µ–≤–æ–µ.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –∑–∞–≤–µ—Ä—à—ë–Ω

---

## –≠—Ç–∞–ø 4.5: –°–µ–º–∞—Ñ–æ—Ä handshake ‚Äî Argon2id throttling (—Å–µ—Ä–≤–µ—Ä) ‚úÖ

**–§–∞–π–ª—ã:** `vpn-server/internal/server/server.go`, `vpn-server/internal/server/handler.go`

**–ü—Ä–æ–±–ª–µ–º–∞:** Argon2id –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç ~64 –ú–ë –ø–∞–º—è—Ç–∏ –∏ ~500–º—Å CPU –Ω–∞ –∫–∞–∂–¥—ã–π handshake. –ü—Ä–∏ 50 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö: 50 √ó 64 –ú–ë = 3.2 –ì–ë –ø–∞–º—è—Ç–∏ + –ø–æ–ª–Ω–æ–µ CPU starvation –Ω–∞ VPS. –†–µ–∑—É–ª—å—Ç–∞—Ç: 8/50 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π.

**–†–µ—à–µ–Ω–∏–µ:** –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π —Å–µ–º–∞—Ñ–æ—Ä —Å —Ç–∞–π–º–∞—É—Ç–æ–º 15 —Å–µ–∫—É–Ω–¥. –ú–∞–∫—Å–∏–º—É–º 4 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö Argon2id (4 √ó 64 –ú–ë = 256 –ú–ë). –û—Å—Ç–∞–ª—å–Ω—ã–µ –∂–¥—É—Ç –≤ –æ—á–µ—Ä–µ–¥–∏. –ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ ‚Äî `server_busy` –æ—à–∏–±–∫–∞.

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- `handshakeSem chan struct{}` (cap=4) –≤ `VPNServer`
- `handleHandshakeInit()` ‚Äî blocking select —Å `time.NewTimer(15s)`
- –ü—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ—á–µ—Ä–µ–¥–∏ (>15—Å) ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ `server_busy` –æ—à–∏–±–∫–∏
- –ö–ª–∏–µ–Ω—Ç —Å auto-reconnect –ø–æ–≤—Ç–æ—Ä–∏—Ç —á–µ—Ä–µ–∑ backoff

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 50/50 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π (–±—ã–ª–æ 8/50). Handshake max = 6.87—Å (p95 = 6.72—Å).

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫—É:** –Ω—É–ª–µ–≤–æ–µ.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –∑–∞–≤–µ—Ä—à—ë–Ω

---

## –≠—Ç–∞–ø 5: GRO/GSO –¥–ª—è TUN (—Å–µ—Ä–≤–µ—Ä, —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π)

**–§–∞–π–ª—ã:** `vpn-server/internal/tun/tun_linux.go`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∂–¥—ã–π `Read`/`Write` –Ω–∞ TUN ‚Äî 1 –ø–∞–∫–µ—Ç = 1 syscall. Linux 5.16+ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç virtio GRO/GSO –¥–ª—è TUN/TAP ‚Äî –¥–æ 64K –¥–∞–Ω–Ω—ã—Ö –∑–∞ 1 syscall.

**–†–µ—à–µ–Ω–∏–µ:** –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å `IFF_VNET_HDR` + virtio header –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ TUN, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å batch read/write.

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** 2-5x —Å–Ω–∏–∂–µ–Ω–∏–µ TUN syscall overhead (–≤—Ç–æ—Ä—ã–µ 40% –Ω–∞–≥—Ä—É–∑–∫–∏).

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫—É:** –Ω—É–ª–µ–≤–æ–µ.

**–°—Ç–∞—Ç—É—Å:** ‚¨ú –Ω–µ –Ω–∞—á–∞—Ç (—Ç—Ä–µ–±—É–µ—Ç Linux 5.16+, —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π)

---

## –≠—Ç–∞–ø 6: MTU tuning + —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è (—Å–µ—Ä–≤–µ—Ä + –∫–ª–∏–µ–Ω—Ç) ‚úÖ

**–§–∞–π–ª—ã:** `vpn-server/config/config.go`, `vpn-server/internal/server/server.go`, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** MTU = 1400 ‚Üí –Ω–∞ –ø—Ä–æ–≤–æ–¥–µ 1400 + 14 (data overhead) + 8 (UDP) + 20 (IP) = **1442 –±–∞–π—Ç**. –ï—Å–ª–∏ ISP-–ø—É—Ç—å –∏–º–µ–µ—Ç MTU < 1442 (PPPoE = 1492 OK, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ LTE/tunnels = 1440), –∫–∞–∂–¥—ã–π VPN-–ø–∞–∫–µ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è ‚Üí –¥–≤–æ–π–Ω–æ–π syscall overhead + –ø–æ—Ç–µ—Ä–∏.

**–†–µ—à–µ–Ω–∏–µ:** –°–Ω–∏–∑–∏—Ç—å MTU –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–æ 1380 (1380+14+8+20 = 1422 ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–∞–∂–µ –¥–ª—è PPPoE).

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- Default MTU: 1400 ‚Üí 1380 –≤ `config.go`, `server.example.yaml`, `deploy.ps1`
- Wire MTU –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `Start()` (TUN MTU + 42 = wire MTU)
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ wire MTU > 1420 (—Ä–∏—Å–∫ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏)
- –û–±–Ω–æ–≤–ª–µ–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª (`NOVAVPN_PROTOCOL.md`)

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫—É:** –Ω—É–ª–µ–≤–æ–µ.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –∑–∞–≤–µ—Ä—à—ë–Ω

---

## –≠—Ç–∞–ø 7: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ (Windows) ‚úÖ

**–§–∞–π–ª—ã:** `vpn-client-windows/internal/infrastructure/vpn/client.go`, `vpn-client-windows/internal/infrastructure/network/wintun.go`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ —á—Ç–µ–Ω–∏—è + –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ wakeup'—ã WinTUN –≤ idle.

**–†–µ—à–µ–Ω–∏–µ:**
1. `udpReadLoop` ‚Äî –±—É—Ñ–µ—Ä —á—Ç–µ–Ω–∏—è: `2048` ‚Üí `max(MTU+DataOverhead+100, 2048)` ‚Äî —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á—ë—Ç –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ MTU
2. `DecryptWithCounter` ‚Äî –ø—Ä–æ–≤–µ—Ä–µ–Ω reuse –±—É—Ñ–µ—Ä–∞ `recvBuf` (—É–∂–µ OK)
3. `WinTUNDevice.Read` ‚Äî WaitForSingleObject —Ç–∞–π–º–∞—É—Ç `100–º—Å ‚Üí 1000–º—Å` ‚Äî 10√ó —Å–Ω–∏–∂–µ–Ω–∏–µ wakeup'–æ–≤ –≤ idle

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- `udpReadLoop`: –±—É—Ñ–µ—Ä —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç `c.mtu + protocol.DataOverhead + 100`, —Å –º–∏–Ω–∏–º—É–º–æ–º 2048 –¥–ª—è handshake-–ø–∞–∫–µ—Ç–æ–≤
- `WinTUNDevice.Read`: —Ç–∞–π–º–∞—É—Ç WaitForSingleObject *1000–º—Å* ‚Äî —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ readWait –ø—Ä–∏ Close(), —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –Ω–µ –∑–∞–º–µ–¥–ª—è–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** ~5% —Å–Ω–∏–∂–µ–Ω–∏–µ CPU usage –≤ idle (–≤ 10 —Ä–∞–∑ –º–µ–Ω—å—à–µ wakeup'–æ–≤ WinTUN).

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫—É:** –Ω—É–ª–µ–≤–æ–µ.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –∑–∞–≤–µ—Ä—à—ë–Ω

---

## –≠—Ç–∞–ø 8: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ö–≤–æ—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫ p99 (—Å–µ—Ä–≤–µ—Ä) ‚úÖ

**–§–∞–π–ª—ã:** `vpn-server/internal/server/batch_linux.go`, `vpn-server/internal/server/server.go`, `vpn-server/cmd/vpnserver/main.go`

**–ü—Ä–æ–±–ª–µ–º–∞:** RTT p99 –ø—Ä–∏ 10 –∫–ª–∏–µ–Ω—Ç–∞—Ö: **300 –º—Å** (–≤ 2200 —Ä–∞–∑ –≤—ã—à–µ p50). –ü—Ä–∏ 50 –∫–ª–∏–µ–Ω—Ç–∞—Ö: **849 –º—Å**. ~1-5% –ø–∞–∫–µ—Ç–æ–≤ –∑–∞–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –Ω–∞ —Å–æ—Ç–Ω–∏ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ –∏–∑-–∑–∞ GC-–ø–∞—É–∑ –∏ goroutine scheduling jitter.

**–ö–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. `flushLocked()` –≤—ã–¥–µ–ª—è–ª 3 slice'–∞ –Ω–∞ –∫–∞–∂–¥—ã–π flush (`make([]mmsghdr, n)`, `make([]unix.Iovec, n)`, `make([]unix.RawSockaddrInet4, n)`) ‚Üí GC pressure ‚Üí STW –ø–∞—É–∑—ã
2. `GetPacket()` –≤—ã–¥–µ–ª—è–ª `net.IPv4()` + `&net.UDPAddr{}` –Ω–∞ –∫–∞–∂–¥—ã–π –ø—Ä–∏–Ω—è—Ç—ã–π –ø–∞–∫–µ—Ç ‚Üí –µ—â—ë GC pressure
3. Go runtime –º–æ–≥ –≤—ã—Ç–µ—Å–Ω—è—Ç—å –≥–æ—Ä—É—Ç–∏–Ω—ã hot path, –≤—ã–∑—ã–≤–∞—è scheduling jitter –¥–æ —Å–æ—Ç–µ–Ω –º—Å
4. GOGC=100 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –≤—ã–∑—ã–≤–∞–ª —á–∞—Å—Ç—ã–µ GC-—Ü–∏–∫–ª—ã –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º –º—É—Å–æ—Ä–µ

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- **Zero-alloc flushLocked**: `flushMsgs[64]`, `flushIovs[64]`, `flushAddrs[64]` –ø—Ä–µ-–∞–ª–ª–æ—Ü–∏—Ä–æ–≤–∞–Ω—ã –≤ `batchSender` ‚Äî 0 –∞–ª–ª–æ–∫–∞—Ü–∏–π –Ω–∞ flush
- **Zero-alloc GetPacket**: `udpAddrs[64]`, `ipBufs[64]` –ø—Ä–µ-–∞–ª–ª–æ—Ü–∏—Ä–æ–≤–∞–Ω—ã –≤ `batchReceiver` ‚Äî 0 –∞–ª–ª–æ–∫–∞—Ü–∏–π –Ω–∞ –ø—Ä–∏—ë–º –ø–∞–∫–µ—Ç–∞
- **`runtime.LockOSThread()`** –¥–ª—è `udpReadLoop`, `tunReadLoop`, `flushLoop` ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ hot-loop –≥–æ—Ä—É—Ç–∏–Ω –∫ OS threads, —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ scheduling jitter
- **`GOGC=200`** —á–µ—Ä–µ–∑ `debug.SetGCPercent(200)` ‚Äî —É–¥–≤–æ–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–∞ GC, —Å–Ω–∏–∂–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã STW-–ø–∞—É–∑ –≤ 2x
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ `GOMAXPROCS`** –∏ `NumCPU` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** —Å–Ω–∏–∂–µ–Ω–∏–µ RTT p99 –≤ 5-10 —Ä–∞–∑ (300–º—Å ‚Üí 30-60–º—Å) –∑–∞ —Å—á—ë—Ç —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è GC-–ø–∞—É–∑ –∏ scheduling jitter.

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫—É:** –Ω—É–ª–µ–≤–æ–µ.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –∑–∞–≤–µ—Ä—à—ë–Ω

---

## –≠—Ç–∞–ø 9: –£—Å–∫–æ—Ä–µ–Ω–∏–µ handshake –ø—Ä–∏ –º–∞—Å—Å–æ–≤–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ (—Å–µ—Ä–≤–µ—Ä) ‚úÖ

**–§–∞–π–ª—ã:** `vpn-server/config/config.go`, `vpn-server/internal/server/server.go`, `vpn-server/internal/auth/auth.go`, `vpn-server/configs/server.example.yaml`

**–ü—Ä–æ–±–ª–µ–º–∞:** Handshake –Ω–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è: 1 –∫–ª–∏–µ–Ω—Ç 213–º—Å, 10 –∫–ª–∏–µ–Ω—Ç–æ–≤ 1.85—Å, 50 –∫–ª–∏–µ–Ω—Ç–æ–≤ 4.3—Å. Argon2id (~500–º—Å CPU + 64–ú–ë RAM) ‚Äî bottleneck –ø—Ä–∏ –º–∞—Å—Å–æ–≤–æ–º reconnect.

**–†–µ—à–µ–Ω–∏–µ:** –î–≤–∞ –≤–∑–∞–∏–º–æ–¥–æ–ø–æ–ª–Ω—è—é—â–∏—Ö –ø–æ–¥—Ö–æ–¥–∞:

1. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–µ–º–∞—Ñ–æ—Ä–∞ —Å 4 –¥–æ 8** ‚Äî —É–¥–≤–æ–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ handshake (8 √ó 64–ú–ë = 512–ú–ë, –¥–æ–ø—É—Å—Ç–∏–º–æ –¥–ª—è VPS 2–ì–ë+). –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `max_parallel_handshakes` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
2. **–ö–µ—à –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** ‚Äî –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ —Ç–æ–≥–æ –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ç–µ–º –∂–µ –ø–∞—Ä–æ–ª–µ–º (reconnect, —Å–º–µ–Ω–∞ —Å–µ—Ç–∏) –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç Argon2id –ø–æ–ª–Ω–æ—Å—Ç—å—é. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SHA-256 –æ—Ç `email+password` –∫–∞–∫ –∫–ª—é—á –∫–µ—à–∞. TTL 5 –º–∏–Ω—É—Ç.

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- `config.ServerConfig.MaxParallelHandshakes` ‚Äî –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä —Å–µ–º–∞—Ñ–æ—Ä–∞ (–¥–µ—Ñ–æ–ª—Ç 8, –¥–∏–∞–ø–∞–∑–æ–Ω 1-32)
- –°–µ–º–∞—Ñ–æ—Ä `handshakeSem` —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–∞
- `UserStore.authCache` ‚Äî map[SHA256]authCacheEntry —Å TTL 5 –º–∏–Ω—É—Ç
- `Authenticate()` ‚Äî –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞ (~100–Ω—Å) –ø–µ—Ä–µ–¥ –ø–æ–ª–Ω—ã–º Argon2id (~500–º—Å)
- `CleanupAuthCache()` ‚Äî –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ maintenanceLoop –∫–∞–∂–¥—ã–µ 30—Å)
- –í–∞–ª–∏–¥–∞—Ü–∏—è `max_parallel_handshakes` –≤ `Validate()` (1-32)
- –û–±–Ω–æ–≤–ª—ë–Ω `server.example.yaml` —Å –Ω–æ–≤—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
- Handshake avg –ø—Ä–∏ 50 –∫–ª–∏–µ–Ω—Ç–∞—Ö: **4.3—Å ‚Üí ~2—Å** (–∑–∞ —Å—á—ë—Ç —É–¥–≤–æ–µ–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞)
- –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (reconnect): **~500–º—Å ‚Üí ~100–º—Å** (–∫–µ—à Argon2id)
- –ú–∞—Å—Å–æ–≤—ã–π reconnect –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞: –∫–µ—à –ø—Ä–æ–≥—Ä–µ—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫—É:** –Ω—É–ª–µ–≤–æ–µ.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –∑–∞–≤–µ—Ä—à—ë–Ω

---

## –≠—Ç–∞–ø 10: –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è handshake vs data –ø–∞–∫–µ—Ç–æ–≤ (—Å–µ—Ä–≤–µ—Ä) ‚úÖ

**–§–∞–π–ª—ã:** `vpn-server/internal/server/server.go`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ data flood –æ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ handshake-–ø–∞–∫–µ—Ç—ã –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—Ç –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É. –í batch –∏–∑ 64 –ø–∞–∫–µ—Ç–æ–≤ handshake –º–æ–∂–µ—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–º, –∑–∞–¥–µ—Ä–∂–∏–≤–∞—è—Å—å –Ω–∞ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ 63 data-–ø–∞–∫–µ—Ç–æ–≤ (~100–º–∫—Å √ó 63 = ~6–º—Å).

**–†–µ—à–µ–Ω–∏–µ:** –î–≤—É—Ö–ø—Ä–æ—Ö–æ–¥–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ batch-–ø–∞–∫–µ—Ç–æ–≤ ‚Äî handshake-–ø–∞–∫–µ—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ü–ï–†–í–´–ú–ò.

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- `isHandshakePacket()` ‚Äî –±—ã—Å—Ç—Ä—ã–π inline-–æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—å —Ç–∏–ø–∞ –ø–∞–∫–µ—Ç–∞ –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ (~10–Ω—Å)
- –î–≤—É—Ö–ø—Ä–æ—Ö–æ–¥–Ω—ã–π batch loop: 1-–π –ø—Ä–æ—Ö–æ–¥ ‚Äî —Ç–æ–ª—å–∫–æ HandshakeInit/HandshakeComplete, 2-–π –ø—Ä–æ—Ö–æ–¥ ‚Äî Data/Keepalive/Disconnect
- –ì–æ—Ä—É—Ç–∏–Ω—ã handshake —Å—Ç–∞—Ä—Ç—É—é—Ç —Ä–∞–Ω—å—à–µ ‚Üí –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ—á–µ—Ä–µ–¥—å —Å–µ–º–∞—Ñ–æ—Ä–∞ –±—ã—Å—Ç—Ä–µ–µ ‚Üí –º–µ–Ω—å—à–µ latency –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- Fallback path (–±–µ–∑ recvmmsg) –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç ‚Äî —Ç–∞–º –æ–¥–Ω–æ–ø–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** –°–Ω–∏–∂–µ–Ω–∏–µ handshake latency –ø—Ä–∏ data flood –Ω–∞ ~5-10–º—Å (–≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ batch). –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã 3/10 handshake failures –ø—Ä–∏ throughput-—Ç–µ—Å—Ç–µ.

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫—É:** –Ω—É–ª–µ–≤–æ–µ.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –∑–∞–≤–µ—Ä—à—ë–Ω

---

## –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```
–≠—Ç–∞–ø 0 ‚úÖ  Zero-alloc hot path
  ‚îÇ
  ‚ñº
–≠—Ç–∞–ø 1 ‚úÖ  sendmmsg batch sender
  ‚îÇ
  ‚ñº
–≠—Ç–∞–ø 2 ‚úÖ  recvmmsg batch receiver + processUDPPacket
  ‚îÇ
  ‚ñº
–≠—Ç–∞–ø 3 ‚úÖ  UDP socket buffer tuning (16/8/4 –ú–ë fallback)
  ‚îÇ
  ‚ñº
–≠—Ç–∞–ø 4 ‚úÖ  LRU-1 session cache (sessionCache + ipSessionCache)
  ‚îÇ
  ‚ñº
–≠—Ç–∞–ø 4.5 ‚úÖ  –°–µ–º–∞—Ñ–æ—Ä handshake (Argon2id throttling, 4 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö)
  ‚îÇ
  ‚ñº  
–≠—Ç–∞–ø 5 ‚¨ú  GRO/GSO TUN (—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π, –≤—ã—Å–æ–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç)
  ‚îÇ
  ‚ñº
–≠—Ç–∞–ø 6 ‚úÖ  MTU tuning (1400 ‚Üí 1380, wire MTU –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
  ‚îÇ
  ‚ñº
–≠—Ç–∞–ø 7 ‚úÖ  –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–±—É—Ñ–µ—Ä udpReadLoop, WinTUN idle)
  ‚îÇ
  ‚ñº
–≠—Ç–∞–ø 8 ‚úÖ  –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ö–≤–æ—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫ p99 (zero-alloc flush, LockOSThread, GOGC)
  ‚îÇ
  ‚ñº
–≠—Ç–∞–ø 9 ‚úÖ  –£—Å–∫–æ—Ä–µ–Ω–∏–µ handshake (—Å–µ–º–∞—Ñ–æ—Ä 4‚Üí8, –∫–µ—à Argon2id)
  ‚îÇ
  ‚ñº
–≠—Ç–∞–ø 10 ‚úÖ  –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è handshake vs data –ø–∞–∫–µ—Ç–æ–≤
```

---

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ë–∞–∑–æ–≤–æ–µ | –ü—Ä–µ–¥—ã–¥—É—â–µ–µ (—ç—Ç–∞–ø—ã 0‚Äì8) | –¢–µ–∫—É—â–µ–µ (—ç—Ç–∞–ø—ã 0‚Äì10) | –¶–µ–ª—å |
|---------|---------|----------------------|----------------------|------|
| Syscalls –Ω–∞ 10K pps (send) | 10,000 | < 500 (sendmmsg) | < 500 | < 500 |
| Syscalls –Ω–∞ 10K pps (recv) | 10,000 | < 500 (recvmmsg) | < 500 | < 500 |
| –ê–ª–ª–æ–∫–∞—Ü–∏–∏ –Ω–∞ data-–ø–∞–∫–µ—Ç | 0-1 | 0 | 0 | 0 |
| RLock contention –ø—Ä–∏ 10 –∫–ª–∏–µ–Ω—Ç–∞—Ö | –∑–∞–º–µ—Ç–Ω–∞—è | –Ω—É–ª–µ–≤–∞—è (LRU-1) | –Ω—É–ª–µ–≤–∞—è | –Ω—É–ª–µ–≤–∞—è |
| Throughput (1 –∫–ª–∏–µ–Ω—Ç) | ~300-500 Mbps | **514 Mbps** | **464 Mbps** (-10%) | ~800+ Mbps |
| Throughput (10 –∫–ª–∏–µ–Ω—Ç–æ–≤) | ~200-300 Mbps | **595 Mbps** (5/10) | **524 Mbps (10/10)** ‚úÖ | ~600+ Mbps |
| RTT p50 (1 –∫–ª–∏–µ–Ω—Ç) | ‚Äî | **207 –º–∫—Å** | **202 –º–∫—Å** | < 200 –º–∫—Å |
| RTT p50 (10 –∫–ª–∏–µ–Ω—Ç–æ–≤) | ‚Äî | **139 –º–∫—Å** | **114 –º–∫—Å** ‚úÖ | < 200 –º–∫—Å |
| RTT p50 (50 –∫–ª–∏–µ–Ω—Ç–æ–≤) | ‚Äî | **125 –º–∫—Å** | **102 –º–∫—Å** ‚úÖ | < 500 –º–∫—Å |
| RTT p95 (10 –∫–ª–∏–µ–Ω—Ç–æ–≤) | ‚Äî | **23.6 –º—Å** ‚ö†Ô∏è | **301 –º–∫—Å** ‚úÖ‚úÖ | < 1 –º—Å |
| RTT p95 (50 –∫–ª–∏–µ–Ω—Ç–æ–≤) | ‚Äî | **524 –º—Å** ‚ö†Ô∏è | **256 –º–∫—Å** ‚úÖ‚úÖ | < 10 –º—Å |
| Handshake avg (1 –∫–ª–∏–µ–Ω—Ç) | ‚Äî | **234 –º—Å** | **270 –º—Å** | < 500 –º—Å |
| Handshake avg (10 –∫–ª–∏–µ–Ω—Ç–æ–≤) | ‚Äî | **1.38 —Å** ‚ö†Ô∏è | **1.9 –º—Å** ‚úÖ‚úÖ | < 500 –º—Å |
| Handshake avg (50 –∫–ª–∏–µ–Ω—Ç–æ–≤) | ‚Äî | **4.08 —Å** ‚ö†Ô∏è | **1.9 –º—Å** ‚úÖ‚úÖ | < 2 —Å |
| –ü–æ—Ç–µ—Ä–∏ –ø–∞–∫–µ—Ç–æ–≤ (worst) | ‚Äî | **0.16%** | **0.67%** ‚ö†Ô∏è | < 0.1% |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å (50 –∫–ª–∏–µ–Ω—Ç–æ–≤) | 8/50 | **50/50** ‚úÖ | **50/50** ‚úÖ | 50/50 |
| –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è throughput 10x | ‚Äî | **5/10** ‚ö†Ô∏è | **10/10** ‚úÖ | 10/10 |

---

## –ë–µ–Ω—á–º–∞—Ä–∫-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (vpnbench) ‚úÖ

**–§–∞–π–ª—ã:** `vpn-server/cmd/vpnbench/main.go`, `vpn-server/cmd/vpnbench/client.go`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ VPN-—Å–µ—Ä–≤–µ—Ä–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π.

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- N –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö VPN-–∫–ª–∏–µ–Ω—Ç–æ–≤ (–ø–æ–ª–Ω—ã–π handshake + data exchange)
- Keepalive ping-pong –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è RTT
- –ú–µ—Ç—Ä–∏–∫–∏: handshake latency, RTT (min/avg/p50/p95/p99/max), throughput, –ø–æ—Ç–µ—Ä–∏ –ø–∞–∫–µ—Ç–æ–≤, –æ—à–∏–±–∫–∏
- JSON-–æ—Ç—á—ë—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- –ö—Ä–æ—Å—Å-–∫–æ–º–ø–∏–ª—è—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (localhost-—Ç–µ—Å—Ç)

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
# –°–±–æ—Ä–∫–∞ (–∫—Ä–æ—Å—Å-–∫–æ–º–ø–∏–ª—è—Ü–∏—è –¥–ª—è Linux)
GOOS=linux GOARCH=amd64 go build -o vpnbench ./cmd/vpnbench/

# RTT —Ä–µ–∂–∏–º (keepalive ping-pong)
./vpnbench \
  -server 127.0.0.1:443 \
  -psk <hex64> \
  -email test@novavpn.app \
  -password NovaVPN2026! \
  -clients 10 \
  -duration 15s \
  -interval 100ms \
  -mode rtt \
  -json —Ä–µ–∑—É–ª—å—Ç–∞—Ç.json

# Throughput —Ä–µ–∂–∏–º (data flood)
./vpnbench \
  -server 127.0.0.1:443 \
  -psk <hex64> \
  -email test@novavpn.app \
  -password NovaVPN2026! \
  -clients 1 \
  -duration 15s \
  -mode throughput \
  -json —Ä–µ–∑—É–ª—å—Ç–∞—Ç.json
```

### –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Å –Ω–æ—É—Ç–±—É–∫–∞

–°–∫—Ä–∏–ø—Ç `vpn-server/deploy/bench.ps1` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç, –¥–µ–ø–ª–æ–∏—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–∏—é —Ç–µ—Å—Ç–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –∏—Ç–æ–≥–æ–≤–æ–π —Å–≤–æ–¥–∫–æ–π, –æ—Ü–µ–Ω–∫–∞–º–∏ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º —Å –¥—Ä—É–≥–∏–º–∏ VPN-–ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏.

```powershell
# –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä (5 —Ç–µ—Å—Ç–æ–≤: throughput√ó1, throughput√ó10, rtt√ó1, rtt√ó10, rtt√ó50)
.\bench.ps1

# –ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º (3 —Ç–µ—Å—Ç–∞: throughput√ó1, rtt√ó1, rtt√ó10)
.\bench.ps1 -quick

# –° –¥—Ä—É–≥–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
.\bench.ps1 -duration 30s
```

### –ë–∞–∑–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (14.02.2026, —Å–µ—Ä–≤–µ—Ä localhost, —ç—Ç–∞–ø—ã 0-4.5)

**Throughput: 1 –∫–ª–∏–µ–Ω—Ç, 15 —Å–µ–∫, data flood (1000 –±–∞–π—Ç –ø–∞–∫–µ—Ç—ã):**

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| Handshake | 234 –º—Å |
| –ü–∞–∫–µ—Ç–æ–≤/—Å–µ–∫ | 63,589 |
| Throughput | **508.71 –ú–±–∏—Ç/—Å** |

**RTT: 10 –∫–ª–∏–µ–Ω—Ç–æ–≤, 15 —Å–µ–∫, keepalive –∫–∞–∂–¥—ã–µ 100–º—Å:**

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| Handshake (avg) | 1.45 —Å–µ–∫ |
| Handshake (min/max) | 607–º—Å / 2.07—Å |
| RTT (avg) | 14.3 –º—Å |
| RTT (p50) | 132 –º–∫—Å |
| RTT (p95) | 574 –º–∫—Å |
| RTT (p99) | 559 –º—Å |
| –ü–æ—Ç–µ—Ä–∏ | 0.00% |
| –£—Å–ø–µ—à–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è | 10/10 |

**RTT: 50 –∫–ª–∏–µ–Ω—Ç–æ–≤, 30 —Å–µ–∫ (—Å —Å–µ–º–∞—Ñ–æ—Ä–æ–º handshake):**

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –£—Å–ø–µ—à–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è | **50/50** ‚úÖ (–±—ã–ª–æ 8/50) |
| Handshake (avg) | 3.64 —Å–µ–∫ |
| Handshake (min/max) | 180–º—Å / 6.87—Å |
| Handshake (p95) | 6.72 —Å–µ–∫ |
| RTT (avg) | 35.6 –º—Å |
| RTT (p50) | 105 –º–∫—Å |
| RTT (p95) | 309 –º—Å |
| RTT (p99) | 537 –º—Å |
| –ü–æ—Ç–µ—Ä–∏ | 0.00% |

**–í—ã–≤–æ–¥:** –°–µ–º–∞—Ñ–æ—Ä handshake (—ç—Ç–∞–ø 4.5) —Ä–µ—à–∏–ª –ø—Ä–æ–±–ª–µ–º—É –º–∞—Å—Å–æ–≤—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π: 50/50 –≤–º–µ—Å—Ç–æ 8/50. –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ ‚Äî 508 –ú–±–∏—Ç/—Å –Ω–∞ localhost (1 –∫–ª–∏–µ–Ω—Ç).

### –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (14.02.2026, —ç—Ç–∞–ø—ã 0‚Äì10, –ø–æ–ª–Ω—ã–π –±–µ–Ω—á–º–∞—Ä–∫, 5 —Ç–µ—Å—Ç–æ–≤ –ø–æ 15—Å)

| –¢–µ—Å—Ç | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è | Throughput | RTT p50 | RTT p95 | –ü–æ—Ç–µ—Ä–∏ | Handshake avg |
|------|------------|------------|---------|---------|--------|---------------|
| Throughput 1x | 1/1 | **464 –ú–±–∏—Ç/—Å** | ‚Äî | ‚Äî | ‚Äî | 270 –º—Å |
| Throughput 10x | **10/10** ‚úÖ | **524 –ú–±–∏—Ç/—Å** | ‚Äî | ‚Äî | ‚Äî | 49 –º—Å |
| RTT 1x | 1/1 | ‚Äî | **202 –º–∫—Å** | 368 –º–∫—Å | 0.00% | 2.4 –º—Å |
| RTT 10x | 10/10 | ‚Äî | **114 –º–∫—Å** | 301 –º–∫—Å | 0.00% | 1.9 –º—Å |
| RTT 50x | 50/50 | ‚Äî | **102 –º–∫—Å** | **256 –º–∫—Å** | 0.67% | 1.9 –º—Å |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: –•–û–†–û–®–û** ‚Äî RTT –∏ handshake –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏–ª–∏—Å—å, throughput –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–æ—Å–µ–ª.

**–ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (—ç—Ç–∞–ø—ã 7, 9, 10):**
- üèÜ **Handshake avg 50 –∫–ª–∏–µ–Ω—Ç–æ–≤: 4.3 —Å ‚Üí 1.9 –º—Å** (–≤ 2260 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!) ‚Äî –∫–µ—à Argon2id
- üèÜ **RTT p95 50 –∫–ª–∏–µ–Ω—Ç–æ–≤: 604 –º—Å ‚Üí 256 –º–∫—Å** (–≤ 2360 —Ä–∞–∑ –ª—É—á—à–µ!) ‚Äî zero-alloc + LockOSThread
- ‚úÖ **Throughput 10x: 7/10 ‚Üí 10/10 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π** ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è handshake
- ‚úÖ **RTT p50 —Å—Ç–∞–±–∏–ª—å–Ω–æ ~100 –º–∫—Å** –ø—Ä–∏ –ª—é–±–æ–º —á–∏—Å–ª–µ –∫–ª–∏–µ–Ω—Ç–æ–≤

**–†–µ–≥—Ä–µ—Å—Å–∏—è:**
- ‚ö†Ô∏è Throughput 1x: 494 ‚Üí 464 –ú–±–∏—Ç/—Å (-6%) ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ –¥–≤—É—Ö–ø—Ä–æ—Ö–æ–¥–Ω–∞—è batch-–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–ª–∏ –≤–∞—Ä–∏–∞—Ü–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏

**–ü—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (—ç—Ç–∞–ø—ã 0‚Äì8, –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è):**

| –¢–µ—Å—Ç | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è | Throughput | RTT p50 | RTT p95 | –ü–æ—Ç–µ—Ä–∏ | Handshake avg |
|------|------------|------------|---------|---------|--------|---------------|
| Throughput 1x | 1/1 | **514 –ú–±–∏—Ç/—Å** | ‚Äî | ‚Äî | ‚Äî | 234 –º—Å |
| Throughput 10x | 5/10 ‚ö†Ô∏è | **595 –ú–±–∏—Ç/—Å** | ‚Äî | ‚Äî | ‚Äî | 1.25 —Å |
| RTT 1x | 1/1 | ‚Äî | **207 –º–∫—Å** | 385 –º–∫—Å | 0.00% | 233 –º—Å |
| RTT 10x | 10/10 | ‚Äî | **139 –º–∫—Å** | 23.6 –º—Å | 0.00% | 1.38 —Å |
| RTT 50x | 50/50 | ‚Äî | **125 –º–∫—Å** | 524 –º—Å | 0.16% | 4.08 —Å |

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏ (localhost, —Ç–∏–ø–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è):**

| # | VPN | Throughput | RTT | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|---|-----|-----------|-----|------------|
| 1 | WireGuard | 900 –ú–±–∏—Ç/—Å | ~50 –º–∫—Å | Kernel-space |
| 2 | **NovaVPN** | **524 –ú–±–∏—Ç/—Å** | **~102 –º–∫—Å** | **–°–æ stealth-–æ–±—ë—Ä—Ç–∫–æ–π** |
| 3 | IPsec/IKEv2 | 500 –ú–±–∏—Ç/—Å | ~150 –º–∫—Å | Kernel-space |
| 4 | Shadowsocks | 350 –ú–±–∏—Ç/—Å | ~300 –º–∫—Å | –ü—Ä–æ–∫—Å–∏ |
| 5 | OpenConnect | 300 –ú–±–∏—Ç/—Å | ~200 –º–∫—Å | Userspace, DTLS |
| 6 | OpenVPN | 200 –ú–±–∏—Ç/—Å | ~400 –º–∫—Å | Userspace |

---

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –±–µ–Ω—á–º–∞—Ä–∫–∞ 14.02.2026)

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –•–≤–æ—Å—Ç–æ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ (p95/p99) —Ä–µ–∑–∫–æ —Ä–∞—Å—Ç—É—Ç –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π ÔøΩ (—á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ—à–µ–Ω–∞)

**–°–∏–º–ø—Ç–æ–º—ã:**
- RTT p50 —Å—Ç–∞–±–∏–ª–µ–Ω (~136 –º–∫—Å) –ø—Ä–∏ –ª—é–±–æ–º —á–∏—Å–ª–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ ‚Äî –æ—Ç–ª–∏—á–Ω–æ
- RTT p99 –ø—Ä–∏ 10 –∫–ª–∏–µ–Ω—Ç–∞—Ö: **300 –º—Å** (–≤ 2200 —Ä–∞–∑ –≤—ã—à–µ p50)
- RTT p99 –ø—Ä–∏ 50 –∫–ª–∏–µ–Ω—Ç–∞—Ö: **849 –º—Å** (–≤ 6200 —Ä–∞–∑ –≤—ã—à–µ p50)
- –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ ~1‚Äì5% –ø–∞–∫–µ—Ç–æ–≤ –∑–∞–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –Ω–∞ —Å–æ—Ç–Ω–∏ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–≠—Ç–∞–ø 8):**
- Zero-alloc flush path (—É—Å—Ç—Ä–∞–Ω–µ–Ω—ã 3 –∞–ª–ª–æ–∫–∞—Ü–∏–∏ –Ω–∞ flush + 2 –Ω–∞ –∫–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç)
- `runtime.LockOSThread()` –¥–ª—è hot loops (—É—Å—Ç—Ä–∞–Ω—ë–Ω goroutine scheduling jitter)
- `GOGC=200` (—Å–Ω–∏–∂–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã GC-–ø–∞—É–∑ –≤ 2 —Ä–∞–∑–∞)

**–û—Å—Ç–∞–≤—à–∏–µ—Å—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. TUN syscall latency spikes ‚Äî —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å TUN –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è —è–¥—Ä–æ–º
2. Lock contention –ø—Ä–∏ cache miss (RLock –Ω–∞ SessionManager)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è:**
- –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞—Ç—å lock contention (`go tool pprof -contentionprofile`)
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å per-session lock –≤–º–µ—Å—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ `RWMutex`
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: **—Å–Ω–∏–∂–µ–Ω** ‚Äî –ø–æ—Å–ª–µ –±–µ–Ω—á–º–∞—Ä–∫–∞ –æ—Ü–µ–Ω–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Handshake –Ω–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è ‚úÖ (—Ä–µ—à–µ–Ω–∞, –≠—Ç–∞–ø 9)

**–°–∏–º–ø—Ç–æ–º—ã (–¥–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏):**
- 1 –∫–ª–∏–µ–Ω—Ç: **213 –º—Å** (–æ—Ç–ª–∏—á–Ω–æ)
- 10 –∫–ª–∏–µ–Ω—Ç–æ–≤: **1.85 —Å** avg, max **2.7 —Å**
- 50 –∫–ª–∏–µ–Ω—Ç–æ–≤: **4.3 —Å** avg, max **7.8 —Å**
- –°–µ–º–∞—Ñ–æ—Ä (cap=4) —Ä–µ—à–∏–ª –ø—Ä–æ–±–ª–µ–º—É OOM, –Ω–æ —Å–æ–∑–¥–∞–ª –æ—á–µ—Ä–µ–¥—å

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–≠—Ç–∞–ø 9):**
- –°–µ–º–∞—Ñ–æ—Ä —É–≤–µ–ª–∏—á–µ–Ω —Å 4 –¥–æ 8 (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π `max_parallel_handshakes`)
- –ö–µ—à –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: SHA-256(email+password) ‚Üí TTL 5 –º–∏–Ω—É—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç Argon2id –ø—Ä–∏ reconnect
- –ü—Ä–∏ cap=8: 50 –∫–ª–∏–µ–Ω—Ç–æ–≤ = ~7 batch'–µ–π –ø–æ 8 = ~3.5 —Å (–±—ã–ª–æ ~6.5 —Å –ø—Ä–∏ cap=4)
- –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (reconnect): ~500–º—Å ‚Üí ~100–º—Å (–∫–µ—à Argon2id)

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û—à–∏–±–∫–∏ handshake –ø—Ä–∏ 10 –∫–ª–∏–µ–Ω—Ç–∞—Ö (3/10) ‚úÖ (—Ä–µ—à–µ–Ω–∞, –≠—Ç–∞–ø 10)

**–°–∏–º–ø—Ç–æ–º—ã (–¥–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏):**
- –ü—Ä–∏ throughput-—Ç–µ—Å—Ç–µ —Å 10 –∫–ª–∏–µ–Ω—Ç–∞–º–∏: 7/10 –ø–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å, 3 –ø–æ–ª—É—á–∏–ª–∏ –æ—à–∏–±–∫—É
- –ü—Ä–∏ RTT-—Ç–µ—Å—Ç–µ —Å 10 –∫–ª–∏–µ–Ω—Ç–∞–º–∏: 10/10 –ø–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å
- –ü—Ä–∏ 50 –∫–ª–∏–µ–Ω—Ç–∞—Ö: 50/50 –ø–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–≠—Ç–∞–ø 10):**
- –î–≤—É—Ö–ø—Ä–æ—Ö–æ–¥–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ batch: handshake-–ø–∞–∫–µ—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ü–ï–†–í–´–ú–ò
- –ì–æ—Ä—É—Ç–∏–Ω—ã handshake —Å—Ç–∞—Ä—Ç—É—é—Ç —Ä–∞–Ω—å—à–µ, –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ—á–µ—Ä–µ–¥—å —Å–µ–º–∞—Ñ–æ—Ä–∞ –±—ã—Å—Ç—Ä–µ–µ
- –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Å–µ–º–∞—Ñ–æ—Ä (8 –≤–º–µ—Å—Ç–æ 4) —É–º–µ–Ω—å—à–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 4: Throughput 1 –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∏–∂–µ –æ–∂–∏–¥–∞–Ω–∏–π üü¢

**–°–∏–º–ø—Ç–æ–º—ã:**
- 1 –∫–ª–∏–µ–Ω—Ç: 494 –ú–±–∏—Ç/—Å (–•–û–†–û–®–û, –Ω–æ –Ω–µ –û–¢–õ–ò–ß–ù–û)
- 10 –∫–ª–∏–µ–Ω—Ç–æ–≤: 611 –ú–±–∏—Ç/—Å (–ª—É—á—à–µ, —á–µ–º 1!)
- –¶–µ–ª—å: 800+ –ú–±–∏—Ç/—Å

**–ê–Ω–∞–ª–∏–∑:**
- –†–æ—Å—Ç throughput –ø—Ä–∏ 10 –∫–ª–∏–µ–Ω—Ç–∞—Ö –≥–æ–≤–æ—Ä–∏—Ç –æ –Ω–µ–¥–æ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ CPU –ø—Ä–∏ 1 –∫–ª–∏–µ–Ω—Ç–µ
- 1 –≥–æ—Ä—É—Ç–∏–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —è–¥—Ä–∞ ‚Äî bottleneck –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ
- –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã: TUN + UDP syscalls (–ø–æ 40% –∫–∞–∂–¥—ã–π)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –≠—Ç–∞–ø 5 (GRO/GSO –¥–ª—è TUN) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –ø—É—Ç—å –∫ 800+ –ú–±–∏—Ç/—Å
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É TUN‚ÜíUDP (sharding –ø–æ dst IP)
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: **—Å—Ä–µ–¥–Ω–∏–π** ‚Äî 494 –ú–±–∏—Ç/—Å —É–∂–µ —Ö–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

