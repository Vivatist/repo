# Визуализация структуры vpn-client-windows

## 📁 Текущее состояние (54 МБ)

```
vpn-client-windows/ ......................... 54 МБ
│
├── 🔴 БИНАРНИКИ (не должны быть в Git) ...... 44 МБ (81%)
│   │
│   ├── dist/ ............................... 26 МБ
│   │   ├── NovaVPN-Setup-1.0.0.exe ......... 7.8 МБ
│   │   ├── NovaVPN.exe ..................... 8.8 МБ
│   │   ├── NovaVPN.zip ..................... 3.9 МБ
│   │   ├── novavpn-service.exe ............. 5.2 МБ
│   │   └── NovaVPN/ (папка) ................ 10 МБ
│   │
│   ├── NovaVPN.exe ......................... 8.8 МБ
│   ├── novavpn-service.exe ................. 5.2 МБ
│   ├── test-handshake.exe .................. 3.7 МБ
│   └── wintun.dll .......................... 418 КБ
│
├── 💻 ИСХОДНЫЙ КОД .......................... 316 КБ
│   │
│   ├── cmd/ (точки входа) .................. 72 КБ
│   │   ├── icongen/ ........................ 7.8 КБ
│   │   ├── novavpn/ (GUI) .................. 2.7 КБ + ресурсы
│   │   └── novavpn-service/ (служба) ....... 3.8 КБ + ресурсы
│   │
│   └── internal/ (26 файлов, 5,206 строк) .. 244 КБ
│       │
│       ├── 🆕 НОВАЯ АРХИТЕКТУРА (12 подпапок)
│       │   ├── domain/ ..................... 5 подпапок (интерфейсы)
│       │   ├── infrastructure/ ............. 5 подпапок (реализации)
│       │   └── application/ ................ 1 подпапка (сервисы)
│       │
│       ├── ⚠️ СТАРАЯ АРХИТЕКТУРА (9 пакетов)
│       │   ├── vpnclient/ .................. 633 строки (монолит)
│       │   ├── gui/ ........................ 671 строка (монолит)
│       │   ├── tunnel/ ..................... 388 строк
│       │   ├── crypto/ ..................... 214 строк
│       │   ├── protocol/ ................... 306 строк
│       │   ├── config/ ..................... 1 файл
│       │   ├── ipc/ ........................ 3 файла
│       │   ├── service/ .................... 2 файла
│       │   └── elevation/ .................. 1 файл
│       │
│       └── 🎨 ПРЕЗЕНТАЦИЯ (пусто)
│           └── presentation/ ............... 3 подпапки (TODO)
│
└── 🛠️ ИНСТРУМЕНТЫ СБОРКИ ................... 15 КБ
    ├── build.bat ........................... 3.7 КБ
    ├── build-installer.bat ................. 2.9 КБ
    ├── Makefile ............................ 1.2 КБ
    ├── installer/novavpn.iss ............... 5.4 КБ
    └── winres/ ............................. 1.7 КБ
```

---

## 🎯 Целевое состояние (10 МБ)

```
vpn-client-windows/ ......................... 10 МБ
│
├── 💻 ИСХОДНЫЙ КОД .......................... 400 КБ
│   │
│   ├── cmd/ (точки входа) .................. 80 КБ
│   │   ├── icongen/ ........................ утилита сборки
│   │   ├── novavpn/ ........................ GUI приложение
│   │   ├── novavpn-service/ ................ Windows служба
│   │   └── test-handshake/ ................. тестовая утилита
│   │
│   └── internal/ ........................... 320 КБ
│       │
│       ├── domain/ ......................... 5 подпапок
│       │   ├── vpn/ ........................ Client, ConnectionState
│       │   ├── network/ .................... TunnelDevice, Configurator
│       │   ├── crypto/ ..................... Session, KeyExchange
│       │   ├── ipc/ ........................ Client, Server
│       │   └── config/ ..................... Manager
│       │
│       ├── infrastructure/ ................. 5 подпапок
│       │   ├── vpn/ ........................ NovaVPNClient, Handshake
│       │   ├── network/ .................... WinTUNDevice, WindowsConfig
│       │   ├── crypto/ ..................... ChaCha20Session
│       │   ├── ipc/ ........................ NamedPipeClient
│       │   └── config/ ..................... JSONConfigManager
│       │
│       ├── application/ .................... 1 подпапка
│       │   └── vpnservice/ ................. VPNService orchestrator
│       │
│       ├── presentation/ ................... 3 подпапки
│       │   ├── windows/ .................... MainWindow (150 строк)
│       │   ├── viewmodels/ ................. ConnectionVM (150 строк)
│       │   └── systray/ .................... TrayIcon (150 строк)
│       │
│       ├── protocol/ ....................... NovaVPN протокол
│       └── elevation/ ...................... UAC utilities
│
├── 📚 ДОКУМЕНТАЦИЯ .......................... 50 КБ
│   ├── docs/ ............................... новая папка
│   │   ├── ARCHITECTURE.md
│   │   ├── FOLDER_STRUCTURE_ANALYSIS.md
│   │   ├── REFACTORING_PROGRESS.md
│   │   └── BUILD.md
│   └── README.md
│
├── 🎨 РЕСУРСЫ .............................. 100 КБ
│   ├── assets/ ............................. новая папка
│   │   ├── logo.svg
│   │   └── logo.ico
│   └── winres/ ............................. конфигурации
│
├── 🛠️ ИНСТРУМЕНТЫ СБОРКИ ................... 15 КБ
│   ├── build.bat
│   ├── build-installer.bat
│   ├── Makefile
│   └── installer/novavpn.iss
│
├── ⚙️ КОНФИГУРАЦИЯ ......................... 10 КБ
│   ├── .gitignore .......................... новый файл
│   ├── go.mod
│   └── go.sum
│
└── 🚫 ИГНОРИРУЕТСЯ Git
    ├── dist/ ............................... артефакты сборки
    ├── *.exe ............................... исполняемые файлы
    ├── *.dll ............................... библиотеки
    └── *.syso .............................. ресурсы Windows
```

---

## 📊 Сравнение метрик

| Метрика | Текущее | Целевое | Улучшение |
|---------|---------|---------|-----------|
| **Размер в Git** | 54 МБ | 10 МБ | **-81%** ✅ |
| **Бинарники** | 44 МБ | 0 МБ | **-100%** ✅ |
| **Подпапок в internal/** | 25 | 15 | **-40%** ✅ |
| **Максимальный размер файла** | 671 строка | <300 | **-55%** ✅ |
| **Дублирование кода** | Есть (старое+новое) | Нет | **-100%** ✅ |

---

## 🔄 Процесс трансформации

### Шаг 1: Очистка (немедленно) ✅

```bash
# Создан .gitignore
*.exe
*.dll
*.syso
/dist/
```

**Результат:** -44 МБ из Git

---

### Шаг 2: Реорганизация кода (в процессе) ⏳

**Удалить старый код:**
```
internal/
├── ❌ vpnclient/    (633 строки)
├── ❌ tunnel/       (388 строк)
├── ❌ gui/app.go    (671 строка)
├── ❌ crypto/       (214 строк)
├── ❌ config/
├── ❌ ipc/
└── ❌ service/
```

**Разделить GUI:**
```
presentation/
├── ✅ windows/main_window.go      (150 строк)
├── ✅ viewmodels/connection_vm.go (150 строк)
└── ✅ systray/tray_icon.go        (150 строк)
```

**Результат:** 25 → 15 подпапок

---

### Шаг 3: Организация документации (TODO)

**Создать структуру:**
```
docs/
├── ARCHITECTURE.md              # Описание архитектуры
├── FOLDER_STRUCTURE_ANALYSIS.md # Этот файл
├── REFACTORING_PROGRESS.md      # Прогресс
└── BUILD.md                     # Инструкции сборки
```

**Создать ресурсы:**
```
assets/
├── logo.svg     # Исходник SVG
└── logo.ico     # Скомпилированная иконка
```

---

## 📈 Визуализация прогресса

### Размер проекта

```
До рефакторинга:
████████████████████████████████████████████████ 54 МБ

После очистки бинарников:
██████████ 10 МБ (исходный код + документация)

Экономия: 44 МБ (81%)
```

---

### Количество подпапок в internal/

```
До:
█████████████████████████ 25 подпапок (дублирование)

После:
███████████████ 15 подпапок (оптимизация)

Сокращение: 10 подпапок (40%)
```

---

### Максимальный размер файла

```
До:
████████████████████████████████████ 671 строка (gui/app.go)
███████████████████████████████      633 строки (vpnclient/client.go)

После:
███████████████ <300 строк (каждый файл модульный)

Улучшение: 55% меньше строк на файл
```

---

## ✅ Чек-лист миграции

### Завершено ✅
- [x] Создан .gitignore
- [x] Создан подробный анализ (FOLDER_STRUCTURE_ANALYSIS.md)
- [x] Создана краткая сводка (FOLDER_STRUCTURE_SUMMARY.md)
- [x] Создана визуализация (этот файл)
- [x] Определены интерфейсы (domain layer)
- [x] Созданы реализации (infrastructure layer)
- [x] Создан application layer

### В процессе ⏳
- [ ] Завершить рефакторинг GUI (671 → 4×150 строк)
- [ ] Обновить service для использования новой архитектуры
- [ ] Протестировать подключение к серверу

### Запланировано 📋
- [ ] Удалить старые пакеты (vpnclient, tunnel, crypto, etc.)
- [ ] Создать папку docs/ и переместить документацию
- [ ] Создать папку assets/ для ресурсов
- [ ] Переместить test-handshake в cmd/test-handshake/
- [ ] Удалить бинарники из Git истории (git rm --cached)

---

## 🎨 Легенда символов

| Символ | Значение |
|--------|----------|
| 🔴 | Критическая проблема |
| 🟡 | Требует внимания |
| 🟢 | Всё хорошо |
| ✅ | Выполнено |
| ⏳ | В процессе |
| 📋 | Запланировано |
| ❌ | Удалить |
| 🆕 | Новый код |
| ⚠️ | Старый код |

---

**Последнее обновление:** 13 февраля 2026  
**Статус:** Анализ завершён, очистка начата
